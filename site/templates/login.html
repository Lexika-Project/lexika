"""_summary_

Returns:
    _type_: _description_
"""
import os
import json
from flask import Flask, jsonify, render_template, request, redirect, session
from werkzeug.utils import secure_filename
from functools import wraps
from database import (
    search,
    modif_data,
    list_langue,
    history,
    get_page_db,
    update_function,
    update_link,
    reference,
    audio,
)

# Mot de passe directement d√©fini
SITE_PASSWORD = 'dikala2025!'

os.chdir(os.path.dirname(__file__))

update_function()

app = Flask(__name__)
app.secret_key = '5bf990faff27d10c2869dce5ce04a5d09ed3b467aa207700187a291c3a1a031b'

def require_password(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if not session.get('authenticated'):
            return redirect('/login')
        return f(*args, **kwargs)
    return decorated_function

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        if request.form.get('password') == SITE_PASSWORD:
            session['authenticated'] = True
            return redirect('/')
        return render_template('login.html', error='Mot de passe incorrect')
    return render_template('login.html')
